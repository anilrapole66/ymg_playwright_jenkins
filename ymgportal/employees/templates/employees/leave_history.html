{% extends parent_template %}

{% block title %}Leave History{% endblock %}
{% block dashboard_content %}

<style>
    h2 {
        color: #111;
        margin: 10px 0 20px 0;
        text-align: center;
        font-family: 'Poppins', sans-serif;
        font-weight: 600;
        font-size: 24px;
    }

    p.note {
        text-align: center;
        color: #555;
        margin-top: -10px;
        margin-bottom: 15px;
        font-size: 13px;
    }

    /* Filters */
    .filters {
        display: flex;
        justify-content: center;
        gap: 10px;
        margin-bottom: 20px;
        flex-wrap: wrap;
    }

    .filters input,
    .filters select {
        padding: 8px 10px;
        border-radius: 8px;
        border: 1px solid #cbd5e1;
        font-size: 13px;
        min-width: 180px;
    }

    .filters button {
        padding: 8px 14px;
        background-color: #cc1939;
        color: white;
        border: none;
        border-radius: 8px;
        cursor: pointer;
        font-size: 13px;
        font-weight: 500;
        transition: 0.25s ease;
    }

    .filters button:hover {
            background: linear-gradient(135deg, #cc1939, #f36c7a);
    }

    /* Links */
    .leave-link {
        color: #cc1939;
        font-weight: 500;
        text-decoration: none;
    }

    .leave-link:hover {
        color: #1d4ed8;
    }

    /* Table */
    table {
        width: 100%;
        border-collapse: collapse;
        margin: 18px 0;
        background: white;
        border-radius: 14px;
        overflow: hidden;
        box-shadow: 0 4px 14px rgba(0,0,0,0.06);
    }

    th, td {
        padding: 10px 12px;
        border-bottom: 1px solid #e5e7eb;
        text-align: left;
        font-size: 13px;
    }

    th {
        background: #cc1939;
        color: white;
        text-transform: uppercase;
        font-size: 12px;
        letter-spacing: 0.3px;
    }

    tr:nth-child(odd) {
        background: #f8fcff;
    }

    tr:hover td {
        background: #eef5ff;
    }

    /* Pagination */
    .pagination-controls {
        margin-top: 12px;
        text-align: center;
    }

    .pagination-controls button {
        background-color: #cc1939;
        border: none;
        padding: 6px 14px;
        border-radius: 6px;
        cursor: pointer;
        font-weight: 600;
        color: white;
        margin: 0 5px;
        font-size: 13px;
        transition: 0.25s ease;
    }

    .pagination-controls button:hover {
            background: linear-gradient(135deg, #cc1939, #f36c7a);
    }

    .pagination-controls button:disabled {
        opacity: 0.45;
        cursor: not-allowed;
    }

    @media(max-width:768px){
        th, td { font-size: 12px; padding: 8px; }
        .filters input, .filters select { width: 100%; }
    }
</style>

<h2>Leave History (Last 3 Months)</h2>
<p class="note">Click on employee name to view full history and balances.</p>

<!-- Filters -->
<form method="get" class="filters">
    <input type="text" name="employee_name"
           placeholder="Search employeeâ€¦"
           value="{{ employee_name }}">

    <select name="month">
        <option value="">Month</option>
        {% for num, name in months %}
            <option value="{{ num }}"
                {% if month == num|stringformat:'s' %}selected{% endif %}>
                {{ name }}
            </option>
        {% endfor %}
    </select>

    <select name="leave_type">
        <option value="">Leave Type</option>
        {% for lt in leave_types %}
            <option value="{{ lt.id }}"
                {% if leave_type_filter == lt.id|stringformat:'s' %}selected{% endif %}>
                {{ lt.name }}
            </option>
        {% endfor %}
    </select>

    <button type="submit">Search</button>
</form>

<!-- Pagination Controls -->
<div class="pagination-controls">
    <button id="prev-btn" type="button">Previous</button>
    <span id="page-number">Page 1</span>
    <button id="next-btn" type="button">Next</button>
</div>

<!-- Table -->
<table id="leaveTable">
    <tr>
        <th>Date</th>
        <th>Employee</th>
        <th>Leave Type</th>
        <th>Source</th>
    </tr>

    {% for row in entries %}
    <tr>
        <td>{{ row.date }}</td>
        <td>
            <a href="{% url 'employee_leave_details' row.employee_id %}"
               class="leave-link">
                {{ row.employee }}
            </a>
        </td>
        <td>{{ row.type }}</td>
        <td>{{ row.source }}</td>
    </tr>
    {% empty %}
    <tr>
        <td colspan="4" style="text-align:center; padding:20px;">
            No records found.
        </td>
    </tr>
    {% endfor %}
</table>

<script>
document.addEventListener("DOMContentLoaded", function () {
    const rows = Array.from(
        document.querySelectorAll("#leaveTable tr")
    ).slice(1); // Skip header row

    const rowsPerPage = 20;
    let currentPage = 1;

    function renderTable() {
        const start = (currentPage - 1) * rowsPerPage;
        const end = start + rowsPerPage;

        rows.forEach((row, index) => {
            row.style.display =
                (index >= start && index < end) ? "" : "none";
        });

        document.getElementById("page-number").innerText =
            `Page ${currentPage}`;

        document.getElementById("prev-btn").disabled =
            (currentPage === 1);

        document.getElementById("next-btn").disabled =
            (end >= rows.length);
    }

    document.getElementById("prev-btn").addEventListener("click", () => {
        if (currentPage > 1) {
            currentPage--;
            renderTable();
            window.scrollTo({ top: 0, behavior: "smooth" });
        }
    });

    document.getElementById("next-btn").addEventListener("click", () => {
        if ((currentPage * rowsPerPage) < rows.length) {
            currentPage++;
            renderTable();
            window.scrollTo({ top: 0, behavior: "smooth" });
        }
    });

    renderTable();
});
</script>

{% endblock %}
