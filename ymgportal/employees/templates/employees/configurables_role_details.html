{% extends 'employees/dashboard.html' %}

{% block title %}
    Configurables - Manage {{ rolesow.name }}
{% endblock %}

{% block dashboard_content %}
<style>
    h2 {
        color: #;
        text-align: center;
        margin-bottom: 10px;
    }
    .section {
        margin-bottom: 30px;
    }
    .section h3 {
        color: #111111;
        margin-bottom: 10px;
    }
    .add-link {
        color: #fff;
        background-color: #cc1939;
        padding: 8px 15px;
        border-radius: 4px;
        text-decoration: none;
        font-size: 0.9rem;

    }
    .add-link:hover {
        background: linear-gradient(135deg, #cc1939, #f36c7a);
    }
    table {
    width: 100%;
    border-collapse: separate;
    border-spacing: 0;
    margin: 15px 0;

    background: #ffffff;
    border-radius: 12px;
    overflow: hidden;

    box-shadow: 0 6px 18px rgba(0, 0, 0, 0.08);
}
    table th, table td {
        padding: 10px;
        text-align: left;
    }
    table th {
        background: #cc1939;
        color: #fff;
    }
    table td, table th:first-child {
    border-top-left-radius: 14px;
}

table tbody tr:not(:last-child) td {
    border-bottom: 1px solid #e5e7eb;
}

table td, table th:last-child {
    border-top-right-radius: 14px;
}

    .details-section {
        margin-bottom: 20px;
        padding: 15px;
        background-color: #f9f9f9;
        border: 1px solid #ddd;
        border-radius: 6px;
    }

    .details-section h3 {
        margin-bottom: 10px;
        color: #cc1939;
        font-size: 1.2rem;
    }

    .details-section p {
        margin: 5px 0;
        font-size: 1rem;
        color: #333;
    }

    .details-section strong {
        color: #cc1939;
        font-weight: bold;
    }

    .link-wrapper {
    margin-bottom: 50px;

</style>

<h2>Manage SOW: {{ rolesow.name }}</h2>

<div class="details-section">
    <h3>Client and Description</h3>
    <p><strong>Client Details:</strong> {{ rolesow.main_client.name }}</p>
    <p><strong>Description:</strong> {{ rolesow.description|default:"No description provided" }}</p>
</div>


<div class="section">
    <h3>Task Types</h3>
    {% if not is_employee_view %}
    <a href="{% url 'add_task_type' rolesow.id %}" class="add-link">Add Task Type</a>
    {% endif %}
    <table >
        <thead>
            <tr>
                <th>Type Name</th>
                <th>Description</th>
            </tr>
        </thead>
        <tbody>
            {% for task_type in task_types %}
            <tr>
                <td>{{ task_type.name }}</td>
                <td>{{ task_type.description }}</td>
            </tr>
            {% empty %}
            <tr>
                <td colspan="2">No task types available.</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>

<div class="section">
    <h3>Tasks</h3>
    {% if is_employee_view %}
<a href="{% url 'employee_add_task' %}" class="add-link">Add My Task</a>
{% else %}
<a href="{% url 'add_task' rolesow.id %}" class="add-link">Add Task</a>
{% endif %}
    <table>
        <thead>
            <tr>
                <th>Task Name</th>
                <th>Added By</th>
                <th>Description</th>
                <th>Type</th>
                <th>Created On</th>

    {% if user.is_staff or user.is_superuser %}
        <th>Status</th>
        <th>Action</th>
    {% endif %}

            </tr>
        </thead>
        <tbody>
            {% for task in tasks %}
            <tr>
                <td>{{ task.name }}</td>
                <td>
    {% if task.is_base %}
        Admin
    {% elif task.associated_employee %}
        {{ task.associated_employee.full_name }}
    {% else %}
        -
    {% endif %}
</td>
                <td>{{ task.description }}</td>
                <td>{{ task.type.name }}</td>
                <td>{{ task.created_on|date:"d M Y" }}</td>
 {% if user.is_staff or user.is_superuser %}
                  <td>
        {% if task.is_active %}
            <span style="color:green;font-weight:600;">Active</span>
        {% else %}
            <span style="color:red;font-weight:600;">Inactive</span>
        {% endif %}
    </td>

    <!-- ACTION (ADMIN ONLY) -->
    <td>
        <form method="post"
              action="{% url 'toggle_task_active' task.id %}"
              style="display:inline;">
            {% csrf_token %}
            <button type="submit"
                    class="add-link"
                    style="padding:4px 10px;font-size:0.8rem;">
                {% if task.is_active %}Deactivate{% else %}Activate{% endif %}
            </button>
        </form>
    </td>
                        {% endif %}

            </tr>
            {% empty %}
            <tr>
                <td colspan="3">No tasks available.</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>
<div class="link-wrapper">
{% if not is_employee_view %}
<a class="add-link" href="{% url 'configurables' %}">Back to Configurables</a>
{% endif %}
</div>
{% endblock %}
