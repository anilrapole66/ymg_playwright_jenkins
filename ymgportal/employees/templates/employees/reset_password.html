{% extends 'employees/base.html' %}
{% block title %}Set New Password{% endblock %}

{% block content %}
<style>
.reset-wrapper {
    min-height: 90vh;
    display: flex;
    justify-content: center;
    align-items: center;
    margin-top: -40px;
}

.reset-box {
    width: 100%;
    max-width: 420px;
    padding: 32px;
    background: white;
    border-radius: 16px;
    box-shadow: 0 8px 24px rgba(0,0,0,0.08);
}

.reset-box h2 {
    text-align: center;
    margin-bottom: 22px;
}

.reset-box input {
    width: 100%;
    padding: 11px 14px;
    margin-bottom: 18px;
    border-radius: 10px;
    border: 1px solid #cbd5e1;
}

.reset-box button {
    width: 100%;
    padding: 12px;
    background: #cc1939;
    color: white;
    border-radius: 12px;
    border: none;
    font-size: 1rem;
}
.reset-box button:hover {
    background: linear-gradient(135deg, #cc1939, #f36c7a);
}
</style>

<div class="reset-wrapper">
    <div class="reset-box">
        <h2>Create New Password</h2>

        <form method="post">
            {% csrf_token %}
            <input type="password" name="password" placeholder="New password" required>
            <input type="password" name="confirm_password" placeholder="Confirm password" required>
            <small style="color:#64748b; display:block; margin-bottom:12px;">
    Password must be at least 8 characters and include:
    uppercase, lowercase, and a special character.
</small>
            <p id="password-error" style="color:#dc2626; font-weight:600; display:none;"></p>

            <button type="submit">Update Password</button>
        </form>
    </div>
</div>

<script>
const passwordInput = document.querySelector('input[name="password"]');
const confirmInput = document.querySelector('input[name="confirm_password"]');
const errorBox = document.getElementById('password-error');

function validatePassword() {
    const pwd = passwordInput.value;

    if (pwd.length < 8) {
        return "Password must be at least 8 characters long.";
    }
    if (!/[A-Z]/.test(pwd)) {
        return "Password must contain at least one uppercase letter.";
    }
    if (!/[a-z]/.test(pwd)) {
        return "Password must contain at least one lowercase letter.";
    }
    if (!/[!@#$%^&*(),.?\":{}|<>]/.test(pwd)) {
        return "Password must contain at least one special character.";
    }
    return null;
}

passwordInput.addEventListener("input", () => {
    const err = validatePassword();
    if (err) {
        errorBox.innerText = err;
        errorBox.style.display = "block";
    } else {
        errorBox.style.display = "none";
    }
});

document.querySelector("form").addEventListener("submit", function (e) {
    const err = validatePassword();

    if (err) {
        e.preventDefault();
        errorBox.innerText = err;
        errorBox.style.display = "block";
        passwordInput.focus();
        return;
    }

    if (passwordInput.value !== confirmInput.value) {
        e.preventDefault();
        errorBox.innerText = "Passwords do not match.";
        errorBox.style.display = "block";
        confirmInput.focus();
    }
});
</script>

{% endblock %}
